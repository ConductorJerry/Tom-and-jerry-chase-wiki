#!/bin/sh

# Only reset SW if it was actually modified and contains real version
if git diff --cached --name-only | grep -q "public/sw.js" && [ -f "public/sw.js" ] && ! grep -q "__CACHE_VERSION__" public/sw.js; then
  echo "ðŸ”„ Resetting service worker to placeholder for development..."
  node -e "
    const fs = require('fs');
    const content = fs.readFileSync('public/sw.js', 'utf8');
    const resetContent = content.replace(/const CACHE_VERSION = '[^']+';/, \"const CACHE_VERSION = '__CACHE_VERSION__';\");
    if (content !== resetContent) {
      fs.writeFileSync('public/sw.js', resetContent);
      console.log('âœ… Service worker reset to development state');
    }
  "
fi

npx lint-staged
